version: "3"

tasks:
  build:
    desc: Build custom golangci-lint with plugins
    cmds:
      - golangci-lint custom
    status:
      - test -f custom-gcl

  default:
    desc: Run linters
    deps: [build]
    cmds:
      - ./custom-gcl run ./...

  fix:
    desc: Run linters and fix issues
    deps: [build]
    cmds:
      - ./custom-gcl run --fix ./...

  fast:
    desc: Lint only changed files
    deps: [build]
    cmds:
      - ./custom-gcl run --new-from-rev=HEAD ./...

  fmt:
    desc: Format code
    cmds:
      - gofumpt -w .
      - goimports -w .

  vet:
    desc: Run go vet
    cmds:
      - go vet ./...

  tidy:
    desc: Tidy go modules
    cmds:
      - go mod tidy

  vulncheck:
    desc: Check for security vulnerabilities
    cmds:
      - govulncheck ./...

  mocks:
    desc: Generate mocks
    cmds:
      - go generate ./...

  complexity:
    desc: Show complexity report
    cmds:
      - |
        echo "=== Cyclomatic Complexity (>10) ==="
        gocyclo -over 10 . || true
        echo ""
        echo "=== Cognitive Complexity (>15) ==="
        gocognit -over 15 . || true
        echo ""
        echo "=== Averages ==="
        gocyclo -avg .
        gocognit -avg .
